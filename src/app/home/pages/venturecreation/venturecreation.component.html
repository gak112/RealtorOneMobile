<ion-header>
  <ion-toolbar style="--border-width: 0;">
    <ion-icon name="chevron-back-outline" class="icon-close" (click)="dismiss()" />
    <ion-title>Create&nbsp;Venture</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="ion-padding">
  <!-- <div class="div-form-main">
    <app-venture-step1></app-venture-step1>
  </div> -->

  <form [formGroup]="ventureForm" (ngSubmit)="submit()">
    <!-- Venture Name -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Venture Name" label-placement="floating" fill="outline"
        placeholder="Enter Venture Name" formControlName="ventureName" />
      @let fullName = ventureForm.controls.ventureName;
      @if (fullName.invalid && (fullName.touched || fullName.dirty)) {
      @if(fullName.errors?.['required']) {
      <div class="div-error">
        <ion-icon name="information-circle" class="icon-info" />
        <span class="name-error">Venture Name is
          Required
        </span>
      </div>
      }
      @else if (fullName.errors?.['minlength']) {
      <div class="div-form">
        <ion-icon name="information-circle" class="icon-info" />
        <span class="name-error">Venture Name should have mininum of 3 Characetrs
        </span>
      </div>
      }
      }
    </div>

    <!-- Description -->
    <div class="div-formgroup">
      <ion-textarea type="text" mode="md" label="Description" label-placement="floating" fill="outline"
        placeholder="Enter Description" rows="5" style="height: auto;" formControlName="description" />
    </div>

    <!-- Venture Location -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Venture Location" label-placement="floating" fill="outline"
        placeholder="Enter Venture Location" formControlName="ventureLocation" />
      @let location = ventureForm.controls.ventureLocation;
      @if (location.invalid && (location.touched || location.dirty)) {
      @if(location.errors?.['required']) {
      <div class="div-error">
        <ion-icon name="information-circle" class="icon-info" />
        <span class="name-error">Venture Location is
          Required
        </span>
      </div>
      }
      }
    </div>
    <!-- Badges -->
    <div class="div-badges">
      <ion-badge color="tertiary">Banjara Hills</ion-badge>
      <ion-badge color="tertiary">Hyderabad</ion-badge>
      <ion-badge color="tertiary">Hyderabad</ion-badge>
      <ion-badge color="tertiary">Telangana</ion-badge>
      <ion-badge color="tertiary">500075</ion-badge>
    </div>

    <!-- Venture Website -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Venture Website" label-placement="floating" fill="outline"
        placeholder="Enter Venture Website" formControlName="ventureWebsite" />
      @if (isInvalid('ventureWebsite')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('ventureWebsite','url')) { Enter a valid URL (http/https). }
      </div>
      }
    </div>

    <!-- Upload logo -->
    <div class="div-upload">
      <ion-label class="upload-label">Upload logo</ion-label>
      <div class="div-add" (click)="logoFileInput.click()">
        <ion-icon name="cloud-upload-outline" class="icon-upload" />
        <ion-label class="label-add">Upload a file or drag and drop</ion-label>
        <span class="label-span">.jpg, .jpeg, .png, up to 2MB</span>
        <input #logoFileInput type="file" accept="image/*" hidden (change)="selectLogo($event)" />
      </div>
      @if (logoPct() !== null) {
      <div style="font-size: 12px; color: var(--green); font-weight: 500;">Uploading: {{ logoPct() }}%</div>
      }
    </div>

    <!-- Logo preview -->
    @if(ventureForm.controls.logo.value) {
    <div class="div-dataimg2">
      <div class="div-uploading" style="width: auto;">
        <ion-icon name="trash-outline" (click)="clearLogo()" />
        <ion-img [src]="ventureForm.controls.logo.value" style="object-fit: contain;" />
      </div>
    </div>
    }

    <!-- Upload Venture Images -->
    <div class="div-upload">
      <ion-label class="upload-label">Upload Venture Images</ion-label>
      <div class="div-add" (click)="imagesFileInput.click()">
        <ion-icon name="cloud-upload-outline" class="icon-upload" />
        <ion-label class="label-add">Upload a file or drag and drop</ion-label>
        <span class="label-span">.jpg, .jpeg, .png, up to 2MB</span>
        <input #imagesFileInput type="file" accept="image/*" multiple hidden (change)="selectVentureImages($event)" />
      </div>
      @if (imgsBusy()) {
      <div style="font-size: 12px; color: var(--green); font-weight: 500;">Uploading images… {{ imgsPct() }}%
      </div>
      }
    </div>

    <!-- Venture Images preview -->
    @if(ventureForm.controls.ventureImages.value.length > 0) {
    <div class="div-venture-images">
      @for (image of ventureForm.controls.ventureImages.value; track $index) {
      <div class="div-uploading">
        <ion-icon name="trash-outline" (click)="deleteImageByUrl(image)" />
        <ion-img [src]="image" />
      </div>
      }
    </div>
    }

    <!-- Amenities -->
    <div class="div-formgroup flex">
      <ion-label class="label-heading">Amenities</ion-label>
      <ion-button size="small" color="warning" (click)="openAmenities()">
        <ion-icon slot="start" name="add" style="font-size: 14px; color: #000;" />
        Add
      </ion-button>
    </div>
    <div class="div-amenities">
      @for (a of amenities(); track a; let i = $index) {
      <span class="badge-amenity">
        {{ a }}
        <ion-icon name="close" (click)="removeAmenity(i)" style="font-size: 14px; color: #fff;" />
      </span>
      }
    </div>

    <!-- Directors -->
    <div class="div-formgroup">
      <ion-textarea type="text" mode="md" label="Directors" label-placement="floating" fill="outline"
        placeholder="Enter Directors" rows="5" style="height: auto;" formControlName="directors" />
      @if (isInvalid('directors')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('directors','maxlength')) { Maximum 2000 characters. }
      </div>
      }
    </div>

    <!-- Company Name -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Company Name" label-placement="floating" fill="outline"
        placeholder="Enter Company Name" formControlName="companyName" />
      @if (isInvalid('companyName')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('companyName','maxlength')) { Maximum 120 characters. }
      </div>
      }
    </div>

    <!-- Company Website -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Company Website" label-placement="floating" fill="outline"
        placeholder="Enter Company Website" formControlName="companyWebsite" />
      @if (isInvalid('companyWebsite')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('companyWebsite','url')) { Enter a valid URL (http/https). }
      </div>
      }
    </div>

    <!-- Facebook -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Facebook Link" label-placement="floating" fill="outline"
        placeholder="Enter Facebook Link" formControlName="facebookLink" />
      @if (isInvalid('facebookLink')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('facebookLink','url')) { Enter a valid URL (http/https). }
      </div>
      }
    </div>

    <!-- Instagram -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Instagram Link" label-placement="floating" fill="outline"
        placeholder="Enter Instagram Link" formControlName="instagramLink" />
      @if (isInvalid('instagramLink')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('instagramLink','url')) { Enter a valid URL (http/https). }
      </div>
      }
    </div>

    <!-- Twitter -->
    <div class="div-formgroup">
      <ion-input type="text" mode="md" label="Twitter Link" label-placement="floating" fill="outline"
        placeholder="Enter Twitter Link" formControlName="twitterLink" />
      @if (isInvalid('twitterLink')) {
      <div class="text-rose-600 text-xs mt-1">
        @if (hasError('twitterLink','url')) { Enter a valid URL (http/https). }
      </div>
      }
    </div>

    <!-- Upload Brochure -->
    <div class="div-upload">
      <ion-label class="upload-label">Upload Brochure</ion-label>
      <div class="div-add" (click)="brochureFileInput.click()">
        <ion-icon name="cloud-upload-outline" class="icon-upload" />
        <ion-label class="label-add">Upload a file or drag and drop</ion-label>
        <span class="label-span">.jpg, .jpeg, .png, up to 2MB</span>
        <input #brochureFileInput type="file" accept="image/*" hidden (change)="selectBrochure($event)" />
      </div>
      @if (brochurePct() !== null) {
      <div style="font-size: 12px; color: var(--green); font-weight: 500;">Uploading: {{ brochurePct() }}%</div>
      }
    </div>

    @if(ventureForm.controls.brochure.value.length > 0) {
    <div class="div-dataimg2">
      <div class="div-uploading" style="width: auto;">
        <ion-icon name="trash-outline" (click)="clearBrochure()" />
        <ion-img [src]="ventureForm.controls.brochure.value" style="object-fit: contain;" />
      </div>
    </div>
    }

    <!-- Land Area + Units -->
    <div>
      <div style="display: flex;align-items: center; margin-bottom: 16px;">
        <div style="margin-right: 16px;flex-grow: 1;">
          <ion-input type="text" mode="md" label="Land Area" label-placement="floating" fill="outline"
            placeholder="Enter Land Area" formControlName="landArea" />
          @if (isInvalid('landArea')) {
          <div class="text-rose-600 text-xs mt-1">
            @if (hasError('landArea','number')) { Enter a valid number. }
            @if (hasError('landArea','maxlength')) { Max 12 digits. }
          </div>
          }
        </div>
        <div style="width: 100px;">
          <ion-select toggleIcon="caret-down-outline" expandedIcon="caret-up-outline" mode="md" label="Units"
            label-placement="floating" fill="outline" class="select-units" formControlName="landAreaUnits">
            <ion-select-option value="Sq Feet">Sq Feet</ion-select-option>
            <ion-select-option value="Sq Yard">Sq Yard</ion-select-option>
            <ion-select-option value="Sq Mtr">Sq Mtr</ion-select-option>
            <ion-select-option value="Acre">Acre</ion-select-option>
          </ion-select>
          @if (isInvalid('landAreaUnits')) {
          <div class="text-rose-600 text-xs mt-1">
            @if (hasError('landAreaUnits','required')) { Units required when Land Area filled. }
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Property Size + Units -->
    <div>
      <div style="display: flex;align-items: center; margin-bottom: 16px;">
        <div style="margin-right: 16px;flex-grow: 1;">
          <ion-input type="text" mode="md" label="Property Size (Build up)" label-placement="floating" fill="outline"
            placeholder="Enter Property Size (Build up)" formControlName="propertySizeBuildUp" />
          @if (isInvalid('propertySizeBuildUp')) {
          <div class="text-rose-600 text-xs mt-1">
            @if (hasError('propertySizeBuildUp','number')) { Enter a valid number. }
            @if (hasError('propertySizeBuildUp','maxlength')) { Max 12 digits. }
          </div>
          }
        </div>
        <div style="width: 100px;">
          <ion-select toggleIcon="caret-down-outline" expandedIcon="caret-up-outline" mode="md" label="Units"
            label-placement="floating" fill="outline" class="select-units" formControlName="propertySizeUnits">
            <ion-select-option value="Sq Feet">Sq Feet</ion-select-option>
            <ion-select-option value="Sq Yard">Sq Yard</ion-select-option>
            <ion-select-option value="Sq Mtr">Sq Mtr</ion-select-option>
            <ion-select-option value="Acre">Acre</ion-select-option>
          </ion-select>
          @if (isInvalid('propertySizeUnits')) {
          <div class="text-rose-600 text-xs mt-1">
            @if (hasError('propertySizeUnits','required')) { Units required when Property Size filled. }
          </div>
          }
        </div>
      </div>
    </div>

    <!-- Open Area (%) -->
    <div style="display: flex;align-items: center;margin-bottom: 16px;">
      <div style="margin: 0;margin-right: 16px;flex-grow: 1;">
        <ion-input type="text" mode="md" label="Open Area" label-placement="floating" fill="outline"
          placeholder="Enter Open Area" style="margin: 0 !important;" formControlName="openArea" />
        @if (isInvalid('openArea')) {
        <div class="text-rose-600 text-xs mt-1">
          @if (hasError('openArea','percentRange')) { Enter a % between 0 and 100. }
        </div>
        }
      </div>
      <ion-label class="label-percentage">%</ion-label>
    </div>

    <!-- Specifications -->
    <div class="div-formgroup flex">
      <ion-label class="label-heading">Specifications</ion-label>
      <ion-button size="small" color="warning" (click)="openAddSpecifications()">
        <ion-icon slot="start" name="add" style="font-size: 14px; color: #000;" />
        Add
      </ion-button>
    </div>
    @if(hasSpecs()) {
    <app-specview [specifications]="specifications()" />
    }

    <!-- Type tabs -->
    <div class="div-input-grid">
      <div class="div-input-sub" [class.active]="actionTab() === 'towerAPT'" (click)="actionTab.set('towerAPT')">
        <div class="div-img-label">
          <ion-img [src]="'assets/img/building.png'" />
          <ion-label class="label-text">Tower/Apartment</ion-label>
        </div>
      </div>
      <div class="div-input-sub" [class.active]="actionTab() === 'houseVilla'" (click)="actionTab.set('houseVilla')">
        <div class="div-img-label">
          <ion-img [src]="'assets/img/duplex.png'" />
          <ion-label class="label-text">House/Villa</ion-label>
        </div>
      </div>
    </div>

    <!-- Tower/Apartment -->
    @if(actionTab() === 'towerAPT') {
    <div class="">
      <div class="div-edit">
        <ion-label class="label-heading">Tower/Apartments</ion-label>
        <ion-button size="small" color="warning" (click)="openTower()">
          <ion-icon slot="start" name="add" style="font-size: 14px; color: #000;" />
          Add
        </ion-button>
      </div>
      @if(isTowerDataOpen()) {
      <app-venture-tower />
      }
    </div>
    }

    <!-- House/Villa -->
    @if(actionTab() === 'houseVilla') {
    <div class="">
      <div class="div-edit">
        <ion-label class="label-heading">Houses/Villas</ion-label>
        <ion-button size="small" color="warning" (click)="openTower()">
          <ion-icon slot="start" name="add" style="font-size: 14px; color: #000;" />
          Add
        </ion-button>
      </div>
      @if(isTowerDataOpen()) {
      <app-venture-housevilla />
      }
    </div>
    }

    <!-- Actions -->
    <!-- <div class="mt-6 flex gap-3">
      <ion-button type="submit" [disabled]="saving()">Save</ion-button>
      @if (saving()) { <ion-label class="text-sm text-slate-500">Saving…</ion-label> }
      @if (savedId()) { <ion-label class="text-sm text-emerald-600">Saved ✓ (ID: {{ savedId() }})</ion-label> }
    </div> -->
  </form>



</ion-content>
<ion-footer>
  <ion-button mode="ios" expand="block" color="warning" class="btn-submit" (click)="submit()">Submit</ion-button>
</ion-footer>